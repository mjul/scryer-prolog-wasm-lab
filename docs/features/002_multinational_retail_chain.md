# Multinationals: Reasoning about Retail Empires

Let's create a Prolog programme to reason about a multinational sock shop company with subsidiaries in various countries and stores in key cities.

## Naming Convention for Predicates
We use the common naming convention `predicate(Subject, Object)` similar to relations there the predicate relation reads between the Subject and Object, e.g. part_of(Derailleur, Bicycle) reads "a Derailleur is a part of a Bicycle".

Here is the pseudo-code for the example company:

## Model
 --- Data: Companies & Hierarchy ---
company(bigco_intl).
company(bigco_iceland).
company(bigco_norway).
company(bigco_denmark).

% --- Data: Subsidiaries ---
has_subsidiary(bigco_intl, bigco_iceland).
has_subsidiary(bigco_intl, bigco_norway).
has_subsidiary(bigco_intl, bigco_denmark).

% --- Data: Stores ---
has_store(bigco_iceland, bigco_reykjavik).
has_store(bigco_iceland, bigco_stykkisholmur).
has_store(bigco_norway, bigco_oslo).
has_store(bigco_denmark, bigco_herning).

% --- Predicate: accounting_currency/2 ---
% Idiomatic: Place specific facts (base cases) before recursive rules.
% This allows Prolog to find the known answers immediately before trying to infer others.

accounting_currency(bigco_iceland, isk).
accounting_currency(bigco_norway, nok).
accounting_currency(bigco_denmark, dkk).

% Recursive Rule: If not defined above, inherit from owner.
accounting_currency(Store, Currency) :-
    has_store(Owner, Store),
    accounting_currency(Owner, Currency).


% --- Logic: Ownership & Definitions ---

% Store definition
store(S) :- 
    has_store(Company, S), 
    company(Company).

% Transitive ownership
% 1. Direct
owns(Parent, Child) :- 
    has_subsidiary(Parent, Child).
% 2. Indirect (Recursive)
owns(Parent, Child) :- 
    has_subsidiary(Parent, Intermediate), 
    owns(Intermediate, Child).

% Helper: Reflexive ownership (useful for finding the top root)
owns_or_self(X, X).
owns_or_self(Parent, Child) :- 
    owns(Parent, Child).

% Top Level Owner: An entity that owns the target (or is the target) 
% and has no parent itself.
top_level_owner(Top, Entity) :-
    owns_or_self(Top, Entity),
    \+ has_subsidiary(_, Top).

%% Now query for the ownership of the stores and their currency

?- store(Store),
   has_store(Owner, Store),
   accounting_currency(Store, Currency),
   top_level_owner(Top, Owner),
   Result = [Top, Owner, Store, Currency].


## First, set up the basic code
- add the Prolog code in app/multinationals/rules.pl
- in app/multinationals/index.tsx add basic screen  using shadcn components. Add these as necessary.
    - show the title "Multinational"
    - show a Card with header "Companies" with a list of the companies built using the Shadcn `Table` component (confusingly called Data Table in the shadcn documentation). This is the master view in the card. The detail view for the selected company is also in the card, when selected: Show the name of the company, its Currency (if defined) and a shadcn `Tree` with its subsidiaries and retail locations. 
    - show a Card with header "All Stores" containing a DataTable with the ownership of the ownership, stores and their currency as generated by the prolog query above. Using the prolog evaluator in app/lib/run-prolog.ts to generate the data.
- Add a route /multinationals that points to the app/multinationals/index.tsx
- Make this the default route when opening the application



    